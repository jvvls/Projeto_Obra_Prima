<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Obra Prima</title>
  
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Bootstrap 5 JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <style>
    :root {
      --primary-color: #27ae60;
      --primary-dark: #1f8c4c;
      --primary-darker: #145c33;
    }
    
    body { 
      background: #f7f7f7; 
      font-family: Arial, sans-serif; 
    }

    /* Acessibilidade - Skip Link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--primary-color);
      color: white;
      padding: 8px;
      text-decoration: none;
      z-index: 100;
    }

    .skip-link:focus {
      top: 0;
    }

    /* Acessibilidade - Foco Vis√≠vel */
    *:focus {
      outline: 3px solid #005fcc;
      outline-offset: 2px;
    }

    button:focus,
    a:focus,
    input:focus,
    select:focus {
      outline: 3px solid #005fcc;
      outline-offset: 2px;
    }

    /* Acessibilidade - Contraste */
    .text-muted {
      color: #495057 !important;
    }

    /* Acessibilidade - Screen Reader Only */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }

    /* Header Customizado */
    .topbar {
      background: var(--primary-color);
      color: white;
    }

    .bell {
      position: relative;
    }

    .bell img {
      height: 24px;
      width: 24px;
      filter: brightness(0) invert(1);
      display: block;
    }

    .logo { 
      height: 40px;
      width: auto;
      display: block;
    }

    /* Navbar Customizada */
    .navbar-custom {
      background: var(--primary-dark) !important;
    }

    /* Cards de Obras */
    .card-obra {
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
    }

    .card-obra:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15) !important;
    }

    .card-obra img {
      height: auto;
      max-height: 300px;
      min-height: 150px;
      width: 100%;
      object-fit: contain;
      background: #f0f0f0;
      display: block !important;
      visibility: visible !important;
    }

    /* Mini Cards */
    .mini-card {
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
    }

    .mini-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 3px 6px rgba(0,0,0,0.15) !important;
    }

    .mini-card .valor {
      font-size: 22px;
      font-weight: bold;
      color: var(--primary-color);
    }

    /* Carrossel */
    .carousel-item {
      min-width: 230px;
    }

    .carousel-item img {
      height: auto;
      max-height: 250px;
      min-height: 150px;
      width: 100%;
      object-fit: contain;
      background: #f0f0f0;
      display: block !important;
      visibility: visible !important;
    }

    /* Feedback Cards */
    .feedback-card {
      border-left: 3px solid var(--primary-color);
    }
  </style>
</head>
<body>

<!-- Skip Link para Acessibilidade -->
<a href="#main-content" class="skip-link">Pular para conte√∫do principal</a>

<!-- Header -->
<header class="topbar py-2" role="banner">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-auto">
        <button class="btn btn-link text-white p-0 border-0 bell" type="button" 
                aria-label="Ver notifica√ß√µes" 
                aria-describedby="notificacoes-desc">
          <img src="img/Bell.png" alt="" aria-hidden="true" 
               style="display: block; height: 24px; width: 24px;"
               onerror="console.error('Erro ao carregar Bell.png'); this.style.display='none'; if(this.nextElementSibling) this.nextElementSibling.style.display='inline';">
          <i class="fas fa-bell" style="display: none; color: white; font-size: 24px;" aria-hidden="true"></i>
          <span class="sr-only">Notifica√ß√µes</span>
        </button>
        <span id="notificacoes-desc" class="sr-only">Clique para ver suas notifica√ß√µes</span>
      </div>
      <div class="col text-center">
        <h4 class="mb-0 fw-bold">Obra Prima</h4>
      </div>
      <div class="col-auto d-flex align-items-center gap-2">
        <img src="img/Logo.png" class="logo" alt="Logo Obra Prima"
             style="display: block; height: 40px; width: auto;"
             onerror="console.error('Erro ao carregar Logo.png'); this.style.display='none'; if(this.nextElementSibling) this.nextElementSibling.style.display='block';">
        <div style="display: none; height: 40px; width: 40px; background: white; border-radius: 5px; line-height: 40px; text-align: center; font-weight: bold; color: var(--primary-color);">OP</div>
        <button class="btn btn-light btn-sm login-btn" type="button" 
                aria-label="Fazer login na plataforma">
          <i class="fas fa-sign-in-alt me-1" aria-hidden="true"></i>Login
        </button>
        <button class="btn btn-sm cadastro-btn" style="background: var(--primary-darker); color: white;" type="button"
                aria-label="Criar nova conta">
          <i class="fas fa-user-plus me-1" aria-hidden="true"></i>Cadastro
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-custom" role="navigation" aria-label="Navega√ß√£o principal">
  <div class="container-fluid">
    <div class="navbar-nav">
      <a class="nav-link text-white fw-bold" href="#" aria-current="page">
        <i class="fas fa-building me-1" aria-hidden="true"></i>Obras
      </a>
    </div>
  </div>
</nav>

<!-- Container Principal -->
<main id="main-content" class="container-fluid py-4" role="main" aria-label="Conte√∫do principal">
  
  <!-- Vis√£o Geral - Mini Cards -->
  <section class="mb-4" aria-labelledby="visao-geral-title">
    <h2 id="visao-geral-title" class="sr-only">Vis√£o Geral das Estat√≠sticas</h2>
    <div class="row g-3" id="visaoGeral" role="list">
      <div class="col-6 col-md-4 col-lg-3 col-xl-2" role="listitem">
        <div class="card mini-card text-center h-100" tabindex="0" role="button" aria-label="Obras Ativas: 12">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">Obras Ativas</h6>
            <p class="card-text valor mb-0" aria-live="polite">12</p>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-4 col-lg-3 col-xl-2">
        <div class="card mini-card text-center h-100">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">Conclu√≠das</h6>
            <p class="card-text valor mb-0">7</p>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-4 col-lg-3 col-xl-2">
        <div class="card mini-card text-center h-100">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">Atrasadas</h6>
            <p class="card-text valor mb-0">3</p>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-4 col-lg-3 col-xl-2">
        <div class="card mini-card text-center h-100">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">Satisfa√ß√£o M√©dia</h6>
            <p class="card-text valor mb-0">4.6 ‚òÖ</p>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-4 col-lg-3 col-xl-2">
        <div class="card mini-card text-center h-100">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">Equipes Ativas</h6>
            <p class="card-text valor mb-0">9</p>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-4 col-lg-3 col-xl-2">
        <div class="card mini-card text-center h-100">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">Custos no M√™s</h6>
            <p class="card-text valor mb-0">R$ 187k</p>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-4 col-lg-3 col-xl-2">
        <div class="card mini-card text-center h-100">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">Materiais em Falta</h6>
            <p class="card-text valor mb-0">5</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Gr√°ficos -->
  <section class="mb-4" aria-labelledby="graficos-title">
    <h2 id="graficos-title" class="sr-only">Gr√°ficos e Indicadores</h2>
    <div class="row g-4">
      <div class="col-lg-6">
        <div class="card">
          <div class="card-body">
            <h3 class="card-title h5">Progresso das Obras</h3>
            <canvas id="graficoProgresso" role="img" aria-label="Gr√°fico de linha mostrando o progresso das obras ao longo dos meses"></canvas>
            <div class="sr-only" id="graficoProgresso-desc">Gr√°fico de linha exibindo o progresso percentual das obras de janeiro a junho</div>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card">
          <div class="card-body">
            <h3 class="card-title h5">Custos Mensais</h3>
            <canvas id="graficoCustos" role="img" aria-label="Gr√°fico de barras mostrando os custos mensais das obras"></canvas>
            <div class="sr-only" id="graficoCustos-desc">Gr√°fico de barras exibindo os custos mensais em reais de janeiro a junho</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Busca -->
  <section class="mb-4" aria-labelledby="busca-title">
    <h2 id="busca-title" class="sr-only">Buscar Obras</h2>
    <div class="card">
      <div class="card-body">
        <form role="search" aria-label="Buscar obras por bairro e tipo" id="formBusca">
          <div class="row g-2">
            <div class="col-md-5">
              <label for="buscaBairro" class="form-label sr-only">Bairro</label>
              <input type="text" class="form-control" placeholder="Bairro" id="buscaBairro" 
                     aria-label="Digite o nome do bairro para buscar">
            </div>
            <div class="col-md-4">
              <label for="buscaTipo" class="form-label sr-only">Tipo de obra</label>
              <select class="form-select" id="buscaTipo" aria-label="Selecione o tipo de obra">
                <option value="">Tipo de obra</option>
                <option value="Residencial">Residencial</option>
                <option value="Comercial">Comercial</option>
              </select>
            </div>
            <div class="col-md-3">
              <button class="btn btn-success w-100" type="submit" id="btnBuscar" aria-label="Buscar obras">
                <i class="fas fa-search me-1" aria-hidden="true"></i>Buscar
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- Obras em Destaque -->
  <section class="mb-4">
    <h2 class="mb-3">Obras em Andamento</h2>
    <div class="row g-3" id="obrasDestaque">
      <!-- Cards ser√£o carregados dinamicamente -->
    </div>
  </section>

  <!-- Bot√£o Ver Todas -->
  <div class="text-center mb-4">
    <button class="btn btn-success btn-lg" type="button" id="btnVerTodas">
      <i class="fas fa-list me-2"></i>Ver todas as obras
    </button>
  </div>

  <!-- Carrossel -->
  <section class="mb-4">
    <h2 class="mb-3">Obras Relevantes</h2>
    <div class="d-flex gap-3 overflow-auto pb-2" id="obrasCarousel" style="scrollbar-width: thin;">
      <!-- Itens ser√£o carregados dinamicamente -->
    </div>
  </section>

  <!-- Gr√°fico de Indicadores -->
  <section class="mb-4" aria-labelledby="indicadores-title">
    <div class="card">
      <div class="card-body">
        <h3 id="indicadores-title" class="card-title h5">Indicadores de Obras</h3>
        <canvas id="graficoObras" role="img" aria-label="Gr√°fico de barras mostrando a quantidade de obras por status"></canvas>
        <div class="sr-only" id="graficoObras-desc">Gr√°fico de barras comparando a quantidade de obras em andamento, conclu√≠das e atrasadas</div>
      </div>
    </div>
  </section>

  <!-- Feedbacks -->
  <section class="mb-4" aria-labelledby="feedbacks-title">
    <h2 id="feedbacks-title" class="mb-3">Feedbacks Recentes</h2>
    <div id="feedbackFeed" role="feed" aria-live="polite" aria-label="Lista de feedbacks dos clientes">
      <!-- Feedbacks ser√£o carregados dinamicamente -->
    </div>
  </section>

</main>

<!-- Footer -->
<footer class="bg-success text-white text-center py-3 mt-4" role="contentinfo">
  <p class="mb-0">¬© 2025 Obra Prima ‚Äî Todos os direitos reservados.</p>
</footer>

<!-- Toast Container -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1055;">
  <div id="toastNotification" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <i class="fas fa-bell me-2"></i>
      <strong class="me-auto">Notifica√ß√£o</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
    </div>
    <div class="toast-body" id="toastBody"></div>
  </div>
</div>

<!-- Modal Login -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="loginModalLabel"><i class="fas fa-sign-in-alt me-2"></i>Login</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="loginForm">
          <div class="mb-3">
            <label for="loginEmail" class="form-label">Email</label>
            <input type="email" class="form-control" id="loginEmail" required>
          </div>
          <div class="mb-3">
            <label for="loginSenha" class="form-label">Senha</label>
            <input type="password" class="form-control" id="loginSenha" required>
          </div>
          <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="lembrarLogin">
            <label class="form-check-label" for="lembrarLogin">Lembrar-me</label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-success" id="btnLoginSubmit">Entrar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Cadastro -->
<div class="modal fade" id="cadastroModal" tabindex="-1" aria-labelledby="cadastroModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="cadastroModalLabel"><i class="fas fa-user-plus me-2"></i>Cadastro</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="cadastroForm">
          <div class="mb-3">
            <label for="cadastroNome" class="form-label">Nome Completo</label>
            <input type="text" class="form-control" id="cadastroNome" required>
          </div>
          <div class="mb-3">
            <label for="cadastroEmail" class="form-label">Email</label>
            <input type="email" class="form-control" id="cadastroEmail" required>
          </div>
          <div class="mb-3">
            <label for="cadastroSenha" class="form-label">Senha</label>
            <input type="password" class="form-control" id="cadastroSenha" required>
          </div>
          <div class="mb-3">
            <label for="cadastroConfirmarSenha" class="form-label">Confirmar Senha</label>
            <input type="password" class="form-control" id="cadastroConfirmarSenha" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-success" id="btnCadastroSubmit">Cadastrar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Notifica√ß√µes -->
<div class="modal fade" id="notificacoesModal" tabindex="-1" aria-labelledby="notificacoesModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="notificacoesModalLabel"><i class="fas fa-bell me-2"></i>Notifica√ß√µes</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="notificacoesLista"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

<!-- Loading Spinner -->
<div id="loadingSpinner" class="d-none position-fixed top-50 start-50 translate-middle" style="z-index: 9999;">
  <div class="spinner-border text-success" role="status" style="width: 3rem; height: 3rem;">
    <span class="visually-hidden">Carregando...</span>
  </div>
</div>

<script>
// ==================== API MOCK - OBRA PRIMA ====================
class ObraPrimaAPI {
  constructor() {
    this.obras = [
      { id: 1, nome: "Residencial Aurora", img: "img/imagem 1.jpg", status: "Andamento", progresso: 75, bairro: "Centro", tipo: "Residencial", custo: 250000, dataInicio: "2024-01-15" },
      { id: 2, nome: "Shopping Mineirinho", img: "img/imagem 2.jpg", status: "Andamento", progresso: 50, bairro: "Jardim Am√©rica", tipo: "Comercial", custo: 500000, dataInicio: "2024-03-01" },
      { id: 3, nome: "Advocacia Rectus", img: "img/imagem 3.jpg", status: "Andamento", progresso: 60, bairro: "Centro", tipo: "Residencial", custo: 300000, dataInicio: "2024-02-10" },
      { id: 4, nome: "Obra Andamento 4", img: "img/imagem 1.jpg", status: "Andamento", progresso: 40, bairro: "Jardim Am√©rica", tipo: "Comercial", custo: 400000, dataInicio: "2024-04-05" },
      { id: 5, nome: "Obra Andamento 5", img: "img/imagem 2.jpg", status: "Andamento", progresso: 55, bairro: "Alto da Boa Vista", tipo: "Residencial", custo: 350000, dataInicio: "2024-03-20" },
      { id: 6, nome: "Advocacia Rectus", img: "img/imagem 3.jpg", status: "Finalizando", progresso: 95, bairro: "Alto da Boa Vista", tipo: "Comercial", custo: 800000, dataInicio: "2023-11-10" },
      { id: 7, nome: "Obra Conclu√≠da 2", img: "img/imagem 1.jpg", status: "Finalizando", progresso: 100, bairro: "Centro", tipo: "Residencial", custo: 450000, dataInicio: "2023-10-15" },
      { id: 8, nome: "Obra Conclu√≠da 3", img: "img/imagem 2.jpg", status: "Finalizando", progresso: 98, bairro: "Jardim Am√©rica", tipo: "Comercial", custo: 600000, dataInicio: "2023-09-20" },
      { id: 9, nome: "Obra Conclu√≠da 4", img: "img/imagem 3.jpg", status: "Finalizando", progresso: 100, bairro: "Centro", tipo: "Residencial", custo: 380000, dataInicio: "2023-08-10" },
      { id: 10, nome: "Obra Conclu√≠da 5", img: "img/imagem 1.jpg", status: "Finalizando", progresso: 97, bairro: "Alto da Boa Vista", tipo: "Comercial", custo: 550000, dataInicio: "2023-12-05" },
      { id: 11, nome: "Obra Conclu√≠da 6", img: "img/imagem 2.jpg", status: "Finalizando", progresso: 100, bairro: "Jardim Am√©rica", tipo: "Residencial", custo: 420000, dataInicio: "2023-07-22" },
      { id: 12, nome: "Obra Conclu√≠da 7", img: "img/imagem 3.jpg", status: "Finalizando", progresso: 99, bairro: "Centro", tipo: "Comercial", custo: 700000, dataInicio: "2023-06-15" },
      { id: 13, nome: "Obra Conclu√≠da 8", img: "img/imagem 1.jpg", status: "Finalizando", progresso: 100, bairro: "Alto da Boa Vista", tipo: "Residencial", custo: 480000, dataInicio: "2023-05-30" },
      { id: 14, nome: "Obra Atrasada", img: "img/imagem 2.jpg", status: "Atrasada", progresso: 45, bairro: "Centro", tipo: "Residencial", custo: 320000, dataInicio: "2023-12-01" }
    ];

    this.feedbacks = [
      { id: 1, texto: "A obra no do conjunto reseidencialno bairro Savassi ocorreu tudo dentro dos conformes!", data: "2025-11-09", autor: "Gestor Adriano Parroco" },
      { id: 2, texto: "Equipe super organizada.", data: "2025-11-08", autor: "Arthur Gomes" },
      { id: 3, texto: "Gostei da transpar√™ncia nos relat√≥rios e na responsatividade do site.", data: "2025-10-28", autor: "Deborah Martins" },
      { id: 4, texto: "Gra√ßas ao site Obra Prima, pude me precaver com uma constru√ß√£o de um pr√©dio que iria come√ßar ao lado de minha casa.", data: "2025-11-04", autor: "Usu√°rio An√¥nimo" }
    ];

    this.notificacoes = [
      { id: 1, titulo: "Nova obra iniciada", mensagem: "A obra Residencial Aurora foi iniciada", lida: false },
      { id: 2, titulo: "Material entregue", mensagem: "Materiais para Shopping Mineirinho foram entregues", lida: false },
      { id: 3, titulo: "Relat√≥rio dispon√≠vel", mensagem: "Novo relat√≥rio mensal dispon√≠vel", lida: true }
    ];
  }

  delay(ms = 500) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  async getObras(filtros = {}) {
    await this.delay(300);
    let obrasFiltradas = [...this.obras];
    if (filtros.bairro) {
      obrasFiltradas = obrasFiltradas.filter(o => o.bairro.toLowerCase().includes(filtros.bairro.toLowerCase()));
    }
    if (filtros.tipo && filtros.tipo !== 'Tipo de obra') {
      obrasFiltradas = obrasFiltradas.filter(o => o.tipo === filtros.tipo);
    }
    return { success: true, data: obrasFiltradas };
  }

  async getObraById(id) {
    await this.delay(200);
    const obra = this.obras.find(o => o.id === id);
    return { success: !!obra, data: obra };
  }

  async getFeedbacks() {
    await this.delay(200);
    return { success: true, data: this.feedbacks };
  }

  async getNotificacoes() {
    await this.delay(200);
    const naoLidas = this.notificacoes.filter(n => !n.lida);
    return { success: true, data: this.notificacoes, naoLidas: naoLidas.length };
  }

  async marcarNotificacaoLida(id) {
    await this.delay(100);
    const notificacao = this.notificacoes.find(n => n.id === id);
    if (notificacao) {
      notificacao.lida = true;
      return { success: true };
    }
    return { success: false };
  }

  async getEstatisticas() {
    await this.delay(200);
    const obrasAtivas = this.obras.filter(o => o.status === 'Andamento').length;
    const obrasConcluidas = this.obras.filter(o => o.status === 'Finalizando').length;
    const obrasAtrasadas = this.obras.filter(o => o.status === 'Atrasada').length;
    return {
      success: true,
      data: {
        obrasAtivas,
        obrasConcluidas,
        obrasAtrasadas,
        satisfacaoMedia: 4.6,
        equipesAtivas: 9,
        custosMes: 187000,
        materiaisFalta: 5
      }
    };
  }

  async login(email, senha) {
    await this.delay(500);
    if (email && senha) {
      return { success: true, data: { token: 'mock_token_12345', usuario: { nome: 'Usu√°rio', email: email } } };
    }
    return { success: false, message: 'Email ou senha inv√°lidos' };
  }

  async cadastro(dados) {
    await this.delay(500);
    if (dados.nome && dados.email && dados.senha) {
      return { success: true, message: 'Cadastro realizado com sucesso!' };
    }
    return { success: false, message: 'Dados inv√°lidos' };
  }
}

const api = new ObraPrimaAPI();

// ==================== SCRIPT PRINCIPAL ====================
const utils = {
  showLoading() {
    document.getElementById('loadingSpinner')?.classList.remove('d-none');
  },
  hideLoading() {
    document.getElementById('loadingSpinner')?.classList.add('d-none');
  },
  showToast(message, type = 'info') {
    const toastEl = document.getElementById('toastNotification');
    const toastBody = document.getElementById('toastBody');
    if (toastEl && toastBody) {
      toastBody.textContent = message;
      const toast = new bootstrap.Toast(toastEl);
      toast.show();
    }
  },
  formatCurrency(value) {
    return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
  }
};

document.addEventListener('DOMContentLoaded', function() {
  
  async function carregarDados() {
    utils.showLoading();
    try {
      // Verificar se as imagens existem
      console.log('üîç Verificando imagens...');
      const obrasResponse = await api.getObras();
      if (obrasResponse.success) {
        console.log('‚úÖ Obras carregadas:', obrasResponse.data.length);
        obrasResponse.data.forEach(obra => {
          console.log(`  - ${obra.nome}: ${obra.img}`);
        });
        carregarCarrossel(obrasResponse.data);
        carregarCardsObras(obrasResponse.data);
      }
      const feedbacksResponse = await api.getFeedbacks();
      if (feedbacksResponse.success) {
        carregarFeedbacks(feedbacksResponse.data);
      }
      const statsResponse = await api.getEstatisticas();
      if (statsResponse.success) {
        atualizarEstatisticas(statsResponse.data);
        atualizarGraficos(statsResponse.data);
      }
      await atualizarNotificacoes();
    } catch (error) {
      console.error('Erro ao carregar dados:', error);
      utils.showToast('Erro ao carregar dados. Tente novamente.', 'error');
    } finally {
      utils.hideLoading();
    }
  }

  function carregarCarrossel(obras) {
    const carousel = document.getElementById("obrasCarousel");
    if (carousel && obras) {
      carousel.innerHTML = '';
      obras.forEach(o => {
        const item = document.createElement('div');
        item.className = 'card carousel-item';
        item.style.minWidth = '230px';
        item.style.cursor = 'pointer';
        const img = document.createElement('img');
        img.src = o.img;
        img.alt = o.nome;
        img.className = 'card-img-top';
        img.style.cssText = 'height: auto; max-height: 250px; min-height: 150px; width: 100%; object-fit: contain; background: #f0f0f0; display: block !important; visibility: visible !important; opacity: 1 !important;';
        img.onload = function() {
          console.log('‚úÖ Imagem carregada:', o.img);
        };
        img.onerror = function() {
          console.error('‚ùå Erro ao carregar imagem:', o.img);
          this.style.background = '#e0e0e0';
          this.style.minHeight = '150px';
          const errorDiv = document.createElement('div');
          errorDiv.textContent = 'Imagem n√£o encontrada';
          errorDiv.style.cssText = 'padding: 20px; text-align: center; color: #999;';
          this.parentNode.insertBefore(errorDiv, this);
        };
        item.appendChild(img);
        const cardBody = document.createElement('div');
        cardBody.className = 'card-body';
        cardBody.innerHTML = `
          <h5 class="card-title">${o.nome}</h5>
          <p class="card-text text-muted mb-0">${o.status} - ${o.progresso}%</p>
        `;
        item.appendChild(cardBody);
        item.addEventListener('click', () => mostrarDetalhesObra(o));
        carousel.appendChild(item);
      });
    }
  }

  function carregarCardsObras(obras) {
    const cardsContainer = document.getElementById('obrasDestaque');
    if (cardsContainer && obras) {
      cardsContainer.innerHTML = '';
      obras.slice(0, 3).forEach(obra => {
        const col = document.createElement('div');
        col.className = 'col-md-6 col-lg-4';
        const card = document.createElement('div');
        card.className = 'card card-obra h-100';
        const img = document.createElement('img');
        img.src = obra.img;
        img.alt = obra.nome;
        img.className = 'card-img-top';
        img.style.cssText = 'height: auto; max-height: 300px; min-height: 150px; width: 100%; object-fit: contain; background: #f0f0f0; display: block !important; visibility: visible !important; opacity: 1 !important;';
        img.onerror = function() {
          console.error('‚ùå Erro ao carregar imagem:', obra.img);
          this.style.background = '#e0e0e0';
          this.style.minHeight = '200px';
          const errorDiv = document.createElement('div');
          errorDiv.textContent = 'Imagem n√£o encontrada';
          errorDiv.style.cssText = 'padding: 20px; text-align: center; color: #999;';
          this.parentNode.insertBefore(errorDiv, this);
        };
        img.onload = function() {
          console.log('‚úÖ Imagem carregada:', obra.img);
        };
        card.appendChild(img);
        const cardBody = document.createElement('div');
        cardBody.className = 'card-body';
        cardBody.innerHTML = `
          <h5 class="card-title">${obra.nome}</h5>
          <p class="card-text">Status: ${obra.status}</p>
          <small class="text-muted">Progresso: ${obra.progresso}%</small>
        `;
        card.appendChild(cardBody);
        card.addEventListener('click', () => mostrarDetalhesObra(obra));
        col.appendChild(card);
        cardsContainer.appendChild(col);
      });
    }
  }

  function mostrarDetalhesObra(obra) {
    const mensagem = `<strong>${obra.nome}</strong><br>Status: ${obra.status}<br>Progresso: ${obra.progresso}%<br>Bairro: ${obra.bairro}<br>Tipo: ${obra.tipo}<br>Custo: ${utils.formatCurrency(obra.custo)}`;
    utils.showToast(mensagem, 'info');
  }

  function carregarFeedbacks(feedbacks) {
    const feedbackFeed = document.getElementById("feedbackFeed");
    if (feedbackFeed && feedbacks) {
      feedbackFeed.innerHTML = '';
      feedbacks.forEach((f, index) => {
        const div = document.createElement('article');
        div.className = 'card mb-2 feedback-card';
        div.setAttribute('role', 'article');
        div.setAttribute('aria-labelledby', `feedback-${index}`);
        div.innerHTML = `
          <div class="card-body">
            <div class="d-flex align-items-start">
              <i class="fas fa-comment-alt me-2 text-success" aria-hidden="true"></i>
              <div class="flex-grow-1">
                <p id="feedback-${index}" class="mb-1">${f.texto}</p>
                <small class="text-muted">
                  <span class="sr-only">Autor: </span>${f.autor} - 
                  <span class="sr-only">Data: </span>${new Date(f.data).toLocaleDateString('pt-BR')}
                </small>
              </div>
            </div>
          </div>
        `;
        feedbackFeed.appendChild(div);
      });
      const announcement = document.createElement('div');
      announcement.className = 'sr-only';
      announcement.setAttribute('aria-live', 'polite');
      announcement.setAttribute('aria-atomic', 'true');
      announcement.textContent = `${feedbacks.length} feedbacks carregados`;
      feedbackFeed.appendChild(announcement);
    }
  }

  function atualizarEstatisticas(stats) {
    const cards = document.querySelectorAll('.mini-card .valor');
    if (cards && stats) {
      const valores = [
        stats.obrasAtivas,
        stats.obrasConcluidas,
        stats.obrasAtrasadas,
        stats.satisfacaoMedia + ' ‚òÖ',
        stats.equipesAtivas,
        'R$ ' + (stats.custosMes / 1000) + 'k',
        stats.materiaisFalta
      ];
      cards.forEach((card, index) => {
        if (valores[index]) {
          card.textContent = valores[index];
        }
      });
    }
  }

  function atualizarGraficos(stats) {
    const graficoObrasCanvas = document.getElementById("graficoObras");
    if (graficoObrasCanvas) {
      new Chart(graficoObrasCanvas, {
        type: "bar",
        data: {
          labels: ["Andamento", "Conclu√≠das", "Atrasadas"],
          datasets: [{ 
            label: "Quantidade de Obras", 
            data: [stats.obrasAtivas, stats.obrasConcluidas, stats.obrasAtrasadas],
            backgroundColor: ["#27ae60", "#2ecc71", "#e74c3c"]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: true },
            tooltip: {
              enabled: true,
              callbacks: {
                label: function(context) {
                  return context.dataset.label + ': ' + context.parsed.y + ' obras';
                }
              }
            }
          },
          accessibility: { enabled: true }
        }
      });
      const desc = document.getElementById('graficoObras-desc');
      if (desc) {
        desc.textContent = `Gr√°fico de barras: ${stats.obrasAtivas} obras em andamento, ${stats.obrasConcluidas} conclu√≠das, ${stats.obrasAtrasadas} atrasadas`;
      }
    }

    const graficoProgressoCanvas = document.getElementById("graficoProgresso");
    if (graficoProgressoCanvas) {
      new Chart(graficoProgressoCanvas, {
        type: "line",
        data: {
          labels: ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun"],
          datasets: [{
            label: "Progresso (%)",
            data: [65, 70, 75, 80, 85, 90],
            borderColor: "#27ae60",
            backgroundColor: "rgba(39, 174, 96, 0.1)",
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: { 
            legend: { display: true },
            tooltip: {
              enabled: true,
              callbacks: {
                label: function(context) {
                  return 'Progresso: ' + context.parsed.y + '%';
                }
              }
            }
          },
          scales: { y: { beginAtZero: true, max: 100 } },
          accessibility: { enabled: true }
        }
      });
      const desc = document.getElementById('graficoProgresso-desc');
      if (desc) {
        desc.textContent = 'Gr√°fico de linha mostrando progresso das obras: Janeiro 65%, Fevereiro 70%, Mar√ßo 75%, Abril 80%, Maio 85%, Junho 90%';
      }
    }

    const graficoCustosCanvas = document.getElementById("graficoCustos");
    if (graficoCustosCanvas) {
      new Chart(graficoCustosCanvas, {
        type: "bar",
        data: {
          labels: ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun"],
          datasets: [{
            label: "Custos (R$)",
            data: [150000, 165000, 180000, 175000, 190000, 187000],
            backgroundColor: "#27ae60"
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: true },
            tooltip: {
              enabled: true,
              callbacks: {
                label: function(context) {
                  return 'Custos: R$ ' + context.parsed.y.toLocaleString('pt-BR');
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return 'R$ ' + (value / 1000) + 'k';
                }
              }
            }
          },
          accessibility: { enabled: true }
        }
      });
      const desc = document.getElementById('graficoCustos-desc');
      if (desc) {
        desc.textContent = 'Gr√°fico de barras mostrando custos mensais: Janeiro R$ 150.000, Fevereiro R$ 165.000, Mar√ßo R$ 180.000, Abril R$ 175.000, Maio R$ 190.000, Junho R$ 187.000';
      }
    }
  }

  async function atualizarNotificacoes() {
    try {
      const response = await api.getNotificacoes();
      if (response.success) {
        const bellButton = document.querySelector('.bell');
        if (bellButton && response.naoLidas > 0) {
          let badge = bellButton.querySelector('.badge');
          if (!badge) {
            badge = document.createElement('span');
            badge.className = 'position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger';
            badge.style.fontSize = '0.7rem';
            bellButton.style.position = 'relative';
            bellButton.appendChild(badge);
          }
          badge.textContent = response.naoLidas;
        }
      }
    } catch (error) {
      console.error('Erro ao carregar notifica√ß√µes:', error);
    }
  }

  async function carregarNotificacoesModal() {
    try {
      const response = await api.getNotificacoes();
      if (response.success) {
        const lista = document.getElementById('notificacoesLista');
        if (lista) {
          lista.innerHTML = '';
          if (response.data.length === 0) {
            lista.innerHTML = '<p class="text-muted text-center">Nenhuma notifica√ß√£o</p>';
          } else {
            response.data.forEach(notif => {
              const div = document.createElement('div');
              div.className = `alert ${notif.lida ? 'alert-light' : 'alert-info'} mb-2`;
              div.innerHTML = `
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <h6 class="mb-1">${notif.titulo}</h6>
                    <p class="mb-0">${notif.mensagem}</p>
                  </div>
                  ${!notif.lida ? '<span class="badge bg-primary">Nova</span>' : ''}
                </div>
              `;
              div.style.cursor = 'pointer';
              div.addEventListener('click', async () => {
                if (!notif.lida) {
                  await api.marcarNotificacaoLida(notif.id);
                  div.classList.remove('alert-info');
                  div.classList.add('alert-light');
                  div.querySelector('.badge')?.remove();
                  await atualizarNotificacoes();
                }
              });
              lista.appendChild(div);
            });
          }
        }
      }
    } catch (error) {
      console.error('Erro ao carregar notifica√ß√µes:', error);
    }
  }

  const bellButton = document.querySelector('.bell');
  if (bellButton) {
    bellButton.addEventListener('click', function() {
      carregarNotificacoesModal();
      const modal = new bootstrap.Modal(document.getElementById('notificacoesModal'));
      modal.show();
    });
  }

  const loginBtn = document.querySelector('.login-btn');
  const cadastroBtn = document.querySelector('.cadastro-btn');
  
  if (loginBtn) {
    loginBtn.addEventListener('click', function() {
      const modal = new bootstrap.Modal(document.getElementById('loginModal'));
      modal.show();
    });
  }

  const btnLoginSubmit = document.getElementById('btnLoginSubmit');
  if (btnLoginSubmit) {
    btnLoginSubmit.addEventListener('click', async function() {
      const email = document.getElementById('loginEmail').value;
      const senha = document.getElementById('loginSenha').value;
      if (!email || !senha) {
        utils.showToast('Preencha todos os campos', 'error');
        return;
      }
      utils.showLoading();
      try {
        const response = await api.login(email, senha);
        if (response.success) {
          utils.showToast('Login realizado com sucesso!', 'success');
          const modal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
          modal.hide();
          localStorage.setItem('token', response.data.token);
          localStorage.setItem('usuario', JSON.stringify(response.data.usuario));
        } else {
          utils.showToast(response.message || 'Erro ao fazer login', 'error');
        }
      } catch (error) {
        utils.showToast('Erro ao fazer login', 'error');
      } finally {
        utils.hideLoading();
      }
    });
  }
  
  if (cadastroBtn) {
    cadastroBtn.addEventListener('click', function() {
      const modal = new bootstrap.Modal(document.getElementById('cadastroModal'));
      modal.show();
    });
  }

  const btnCadastroSubmit = document.getElementById('btnCadastroSubmit');
  if (btnCadastroSubmit) {
    btnCadastroSubmit.addEventListener('click', async function() {
      const nome = document.getElementById('cadastroNome').value;
      const email = document.getElementById('cadastroEmail').value;
      const senha = document.getElementById('cadastroSenha').value;
      const confirmarSenha = document.getElementById('cadastroConfirmarSenha').value;
      if (!nome || !email || !senha || !confirmarSenha) {
        utils.showToast('Preencha todos os campos', 'error');
        return;
      }
      if (senha !== confirmarSenha) {
        utils.showToast('As senhas n√£o coincidem', 'error');
        return;
      }
      utils.showLoading();
      try {
        const response = await api.cadastro({ nome, email, senha });
        if (response.success) {
          utils.showToast('Cadastro realizado com sucesso!', 'success');
          const modal = bootstrap.Modal.getInstance(document.getElementById('cadastroModal'));
          modal.hide();
        } else {
          utils.showToast(response.message || 'Erro ao cadastrar', 'error');
        }
      } catch (error) {
        utils.showToast('Erro ao cadastrar', 'error');
      } finally {
        utils.hideLoading();
      }
    });
  }

  const navLinks = document.querySelectorAll('nav a');
  navLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      navLinks.forEach(l => l.classList.remove('active'));
      this.classList.add('active');
      utils.showToast(`Navegando para: ${this.textContent.trim()}`, 'info');
    });
  });

  const buscaForm = document.getElementById('formBusca');
  const buscaInput = document.getElementById('buscaBairro');
  const buscaSelect = document.getElementById('buscaTipo');
  const buscaButton = document.getElementById('btnBuscar');
  
  async function executarBusca() {
    const bairro = buscaInput.value.trim();
    const tipoObra = buscaSelect.value;
    if (bairro || tipoObra) {
      utils.showLoading();
      try {
        const response = await api.getObras({ bairro, tipo: tipoObra });
        if (response.success) {
          carregarCarrossel(response.data);
          carregarCardsObras(response.data);
          const mensagem = `${response.data.length} obra(s) encontrada(s)`;
          utils.showToast(mensagem, 'success');
        }
      } catch (error) {
        utils.showToast('Erro ao buscar obras', 'error');
      } finally {
        utils.hideLoading();
      }
    } else {
      utils.showToast('Preencha pelo menos um campo de busca', 'warning');
    }
  }
  
  if (buscaForm) {
    buscaForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      await executarBusca();
    });
  }
  
  if (buscaButton) {
    buscaButton.addEventListener('click', async function(e) {
      e.preventDefault();
      await executarBusca();
    });
  }

  const verTodasBtn = document.getElementById('btnVerTodas');
  if (verTodasBtn) {
    verTodasBtn.addEventListener('click', async function() {
      utils.showLoading();
      try {
        const response = await api.getObras();
        if (response.success) {
          carregarCarrossel(response.data);
          carregarCardsObras(response.data);
          utils.showToast('Todas as obras carregadas', 'success');
        }
      } catch (error) {
        utils.showToast('Erro ao carregar obras', 'error');
      } finally {
        utils.hideLoading();
      }
    });
  }

  const miniCards = document.querySelectorAll('.mini-card');
  miniCards.forEach(card => {
    card.addEventListener('click', function() {
      const titulo = this.querySelector('h6').textContent;
      const valor = this.querySelector('.valor').textContent;
      utils.showToast(`${titulo}: ${valor}`, 'info');
    });
  });

  carregarDados();
  atualizarNotificacoes();
  
  console.log('‚úÖ Todas as funcionalidades foram inicializadas!');
});
</script>

</body>
</html>

